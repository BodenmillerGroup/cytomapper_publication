bcg = list(PIN = c(0, 4, 1),
SYP = c(0, 2, 1),
CD4 = c(0, 5, 1),
CD8a = c(0, 2, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "SYP", "CD4", "CD8a"),
colour = list(PIN = c("black", "green"),
SYP = c("black", "blue"),
CD4 = c("black", "red"),
CD8a = c("black", "yellow")),
bcg = list(PIN = c(0, 4, 1),
SYP = c(0, 2, 1),
CD4 = c(0, 10, 1),
CD8a = c(0, 2, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "SYP", "CD4", "CD8a"),
colour = list(PIN = c("black", "green"),
SYP = c("black", "blue"),
CD4 = c("black", "red"),
CD8a = c("black", "yellow")),
bcg = list(PIN = c(0, 4, 1),
SYP = c(0, 2, 1),
CD4 = c(-50, 10, 1),
CD8a = c(0, 2, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "SYP", "CD4", "CD8a"),
colour = list(PIN = c("black", "green"),
SYP = c("black", "blue"),
CD4 = c("black", "red"),
CD8a = c("black", "yellow")),
bcg = list(PIN = c(0, 4, 1),
SYP = c(0, 2, 1),
CD4 = c(-1, 10, 1),
CD8a = c(0, 2, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "SYP", "CD4", "CD8a"),
colour = list(PIN = c("black", "green"),
SYP = c("black", "blue"),
CD4 = c("black", "red"),
CD8a = c("black", "yellow")),
bcg = list(PIN = c(0, 4, 1),
SYP = c(0, 2, 1),
CD4 = c(-10, 10, 1),
CD8a = c(0, 2, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "SYP", "CD4", "CD8a"),
colour = list(PIN = c("black", "green"),
SYP = c("black", "blue"),
CD4 = c("black", "red"),
CD8a = c("black", "yellow")),
bcg = list(PIN = c(0, 4, 1),
SYP = c(0, 2, 1),
CD4 = c(0, 10, 1),
CD8a = c(0, 2, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "SYP", "CD4", "CD8a"),
colour = list(PIN = c("black", "green"),
SYP = c("black", "blue"),
CD4 = c("black", "red"),
CD8a = c("black", "yellow")),
bcg = list(PIN = c(0, 4, 1),
SYP = c(0, 2, 1),
CD4 = c(0, 5, 1),
CD8a = c(0, 2, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
# Define the colors for the different cell types
ct_colours <- vector(mode = "character", length = length(unique(cur_sce$CellType)))
names(ct_colours) <- unique(cur_sce$CellType)
ct_colours["beta"] <- "green"
ct_colours[c("alpha", "delta")] <- "blue"
ct_colours["Tc"] <- "yellow"
ct_colours["Th"] <- "red"
# Plot the cells
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1,
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
cex = 1.1,
colour = "black"),
missing_colour = "white",
background_colour = "gray")
cur_sce <- cur_sce[,cur_sce$CellType %in% c("beta", "alpha", "delta", "Tc", "Th")]
# Define the colors for the different cell types
ct_colours <- vector(mode = "character", length = length(unique(cur_sce$CellType)))
names(ct_colours) <- unique(cur_sce$CellType)
ct_colours["beta"] <- "yellow"
ct_colours[c("alpha", "delta")] <- "cyan"
ct_colours["Tc"] <- "red"
ct_colours["Th"] <- "blue"
# Plot the cells
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1,
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
cex = 1.1,
colour = "black"),
missing_colour = "white",
background_colour = "gray")
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "CD4", "CD8a"),
colour = list(PIN = c("black", "yellow"),
# SYP = c("black", "cyan"),
CD4 = c("black", "blue"),
CD8a = c("black", "red")),
bcg = list(PIN = c(0, 4, 1),
# SYP = c(0, 3, 1),
CD4 = c(0, 3, 1),
CD8a = c(0, 3, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
# Define the colors for the different cell types
cat.colours <- rep("black", length(unique(sce$CellCat)))
names(cat.colours) <- unique(sce$CellCat)
cat.colours["islet"] <- "yellow"
cat.colours["immune"] <- "red"
# Plot the cells
plotCells(mask = cur.masks,
object = cur.sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellCat",
colour = list(CellCat = cat.colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
# Define the colors for the different cell types
cat_colours <- rep("black", length(unique(sce$CellCat)))
names(cat_colours) <- unique(sce$CellCat)
cat_colours["islet"] <- "yellow"
cat_colours["immune"] <- "red"
# Plot the cells
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellCat",
colour = list(CellCat = cat_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(object = cur.sce,
image = cur.images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "CD4", "CD8a", "CD20", "CD68", "MPO"),
colour = list(PIN = c("black", "yellow"),
CD4 = c("black", "cyan"),
CD8a = c("black", "red"),
CD20 = c("black", "white"),
CD68 = c("black", "blue"),
MPO = c("black", "magenta")),
bcg = list(PIN = c(0, 4, 1.2),
CD4 = c(0, 4, 1),
CD8a = c(0, 5, 1.2),
CD20 = c(0, 5, 1.2),
CD68 = c(0, 5, 1.2),
MPO = c(0, 5, 1.2)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "CD4", "CD8a", "CD20", "CD68", "MPO"),
colour = list(PIN = c("black", "yellow"),
CD4 = c("black", "cyan"),
CD8a = c("black", "red"),
CD20 = c("black", "white"),
CD68 = c("black", "blue"),
MPO = c("black", "magenta")),
bcg = list(PIN = c(0, 4, 1.2),
CD4 = c(0, 4, 1),
CD8a = c(0, 5, 1.2),
CD20 = c(0, 5, 1.2),
CD68 = c(0, 5, 1.2),
MPO = c(0, 5, 1.2)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
?plotCells
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1,
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
cex = 1.1,
colour = "black"),
missing_colour = "white",
background_colour = "gray",
save_plot = list(filename = "docs/final_figures/main/Fig_1B.png"))
# Plot the cells
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1,
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
cex = 1.1,
colour = "black"),
missing_colour = "white",
background_colour = "gray")
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1,
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
cex = 1.1,
colour = "black"),
missing_colour = "white",
background_colour = "gray",
save_plot = list(filename = "docs/final_figures/main/Fig_1B.png"))
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
cex = 1.1,
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
cex = 1.1,
colour = "black"),
missing_colour = "white",
background_colour = "gray",
save_plot = list(filename = "docs/final_figures/main/Fig_1B.png", scale = 4))
# Plot the cells
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
colour = "black"),
missing_colour = "white",
background_colour = "gray")
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
colour = "black"),
missing_colour = "white",
background_colour = "gray",
save_plot = list(filename = "docs/final_figures/main/Fig_1B.png", scale = 4))
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
colour = "black"),
missing_colour = "white",
background_colour = "gray",
save_plot = list(filename = "docs/final_figures/main/Fig_1B.png"))
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
colour = "black"),
missing_colour = "white",
background_colour = "gray",
save_plot = list(filename = "docs/final_figures/main/Fig_1B.png", scale = 2))
plotCells(mask = cur_masks,
object = cur_sce,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = "CellType",
colour = list(CellType = ct_colours),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D"),
colour = "black"),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m"),
colour = "black"),
missing_colour = "white",
background_colour = "gray",
save_plot = list(filename = "docs/final_figures/main/Fig_1B.png", scale = 3))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "CD4", "CD8a"),
colour = list(PIN = c("black", "yellow"),
# SYP = c("black", "cyan"),
CD4 = c("black", "blue"),
CD8a = c("black", "red")),
bcg = list(PIN = c(0, 4, 1),
# SYP = c(0, 3, 1),
CD4 = c(0, 3, 1),
CD8a = c(0, 3, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D")),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")))
plotPixels(image = cur_images,
cell_id = "CellNumber",
img_id = "ImageName",
colour_by = c("PIN", "CD4", "CD8a"),
colour = list(PIN = c("black", "yellow"),
# SYP = c("black", "cyan"),
CD4 = c("black", "blue"),
CD8a = c("black", "red")),
bcg = list(PIN = c(0, 4, 1),
# SYP = c(0, 3, 1),
CD4 = c(0, 3, 1),
CD8a = c(0, 3, 1)),
image_title = list(text = c("Non-diabetic",
"Recent onset T1D",
"Long duration T1D")),
scale_bar = list(length = 100,
label = expression("100 " ~ mu * "m")),
save_plot = list(filename = "docs/final_figures/main/Fig_1C.png", scale = 3))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2: read-in-data
library(dplyr)
library(SingleCellExperiment)
library(cytomapper)
sce <- readRDS("data/PancreasData/pancreas_sce.rds")
images <- readRDS("data/PancreasData/pancreas_images.rds")
masks <- readRDS("data/PancreasData/pancreas_masks.rds")
# Chunk 3: select-images
# Select the three images with the higest T cell density
selected.images <- as_tibble(colData(sce)) %>%
# Calculate for each image the area, number of T cells and T cell density
group_by(ImageNumber) %>%
mutate(ImageArea = (width * height) / 10^6,
TcellCount = sum(CellType == "Tc" | CellType == "Th"),
TcellDensity = TcellCount / ImageArea) %>%
ungroup() %>%
# Select for each disease stage the image with the highest T cell density
group_by(stage) %>%
dplyr::slice(which.max(TcellDensity)) %>%
pull(ImageName)
print(selected.images)
# Subset the objects
cur_sce <- sce[, sce$ImageName %in% selected.images]
cur_images <- images[mcols(images)$ImageName %in% selected.images]
cur_masks <- masks[mcols(masks)$ImageName %in% selected.images]
# Select the three images with the higest T cell density
selected.images <- as_tibble(colData(sce)) %>%
# Calculate for each image the area, number of T cells and T cell density
group_by(ImageNumber) %>%
mutate(ImageArea = (width * height) / 10^6,
TcellCount = sum(CellType == "Tc" | CellType == "Th"),
TcellDensity = TcellCount / ImageArea) %>%
ungroup() %>%
# Select for each disease stage the image with the highest T cell density
group_by(stage) %>%
dplyr::slice(which.max(TcellDensity)) %>%
pull(ImageName)
print(selected.images)
# Subset the objects
cur_sce <- sce[, sce$ImageName %in% selected.images]
cur_images <- images[mcols(images)$ImageName %in% selected.images]
cur_masks <- masks[mcols(masks)$ImageName %in% selected.images]
cur_sce
saveRDS(cur_sce, "~/Dropbox (Personal)/Zürich/Postdoc/Presentations/Lab_meeting/200608/Coding/Data/sce.rds/")
saveRDS(cur_sce, "~/Dropbox (Personal)/Zürich/Postdoc/Presentations/Lab_meeting/200608/Coding/Data/sce.rds")
saveRDS(cur_sce, "~/Dropbox (Personal)/Zürich/Postdoc/Presentations/Lab_meetings/200608/Coding/Data/sce.rds")
cur_masks
selected.images
colData(sce)
colData(sce)[sce$ImageName == "E30",]
cur_masks
colData(sce)[sce$ImageName == "G23",]
colData(sce)[sce$ImageName == "J01",]
channelNames(images)
